apiVersion: apps/v1
kind: Deployment
metadata:
  name: reflect-server
spec:
  replicas: 1
  selector:
    matchLabels:
      app: reflect-server
  strategy:
    type: Recreate
  template:
    metadata:
      labels:
        app: reflect-server
    spec:
      containers:
      - image: netfoundry/reflect-server:latest
        name: reflect-server
        env:
        - name: IDENTITY_FILE # JSON file in same dir as this Compose file
          value: reflect-server.json
        - name: SERVICE_NAME  # Ziti service name to bind e.g. "ACME Reflect Server"
          value: "My Reflect Service"
        volumeMounts:
        - name: reflect-server-identity
          mountPath: "/identity"
          readOnly: true
#        securityContext:
#          runAsUser: 1000
#          runAsGroup: 1000
      restartPolicy: Always
      volumes:
      - name: reflect-server-identity
        secret: # kubectl create secret generic reflect-server-identity --from-file=reflect-server-identity=./reflect-server-identity.json
          secretName: reflect-server-identity
          defaultMode: 0400
          items:
          - key: reflect-server-identity
            path: reflect-server.json
